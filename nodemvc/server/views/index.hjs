<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title> Servers Dashboard</title>
<script src="//code.jquery.com/jquery-1.11.2.js"></script>
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script type="text/javascript" src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
<script type="text/javascript" src="//code.jquery.com/ui/1.11.2/jquery-ui.min.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css" />
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" />
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css" />
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" />
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css" />
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css" />

    <link href="css/bootstrap.min.css" rel="stylesheet" />
</head>

<body>
<script src="../javascripts/piechart.js"></script>
<script src="../javascripts/bootbox.min.js" %}"></script>
<style>
.sidebarUI {
    position: absolute;
    left: 20px;
    top: 50px;
}
.mainContentUI{
    position: absolute;
    left: 300px;
    top: 50px;
}
</style>
<link rel="../stylesheets/custom.css"/>
	
	<div id="page-wrap">

	</div>
      <!--<div id="container"> -->

    <div class="container">
        <div class="row">
            <div class="col-lg-12 vcenter">
                <h1>Servers List</h1>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-lg-12 vcenter">

        <div class='topbar'>

    <nav class="navbar navbar-inverse navbar-fixed-top vcenter" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>

            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li>
                             <img src="../images/mylogo.png"  width="50%" height="150%">
                    </li>
                    <li>
                         <h3 style="color:white">
                         Inventory <small> - Servers List</small>
                         </h3>
                    </li>
                    <li>
                        <a href="#">     </a>
                    </li>
                    <li>
                        <a href="#">     </a>
                    </li>
                    <li>
                        <a href="#">About</a>
                    </li>
                    <li>
                        <a href="#">Services</a>
                    </li>
                    <li>
                        <a href="#">Contact</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</div> <!-- topbar -->
            </div>
        </div>
   <!-- </div> -->

<!--</div> --> <!-- id = container -->

<div id='main_content'>
          
<div class="messages">
</div>

<!--    <div class="container"> -->
        <div class="row">
            <div class="col-lg-12 vcenter">
<div class='sidebar sidebarUI'>
  


<div>
  <dl class="nav_accordion">
  
    
      
        <dt class="active">
          <div>Servers</div>
        </dt>
        
        <dd>
          
          
            
            <div><h4><div>BareMetal</div></h4>
            
            <ul>
            
              <li><a href="" class="active" >Summary</a></li>
            
            </ul>
            
              </div>
            
        
          
          
            
            <div><h4><div>Unmanaged</div></h4>
            
            <ul>
            
              <li><a href="#">Summary</a></li>
            
            </ul>
            
              </div>
            
          
          
            
            <div><h4><div>Managed</div></h4>
            
            <ul>
            
              <li><a href="#">Summary</a></li>
            
            </ul>
            
              </div>
            
          
          
        
          
          
          
        
        </dd>
      
    
  
    
  
  </dl>
</div>


</div> <!-- sidebar -->
            </div>
            <div class="col-lg-12 vcenter mainContentUI">
 <!--<div id='content_body'> -->
            
  <div class='page-header'>
    <h2>Servers List</h2>
  </div>
   <!-- 
    <div class="container">
        <div class="row">
            <div class="col-lg-12 vcenter">
                <h1>Servers List</h1>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-lg-12 vcenter">
                <h1>Servers List</h1>
            </div>
        </div>
    </div>
-->


<!--
    <div class="container">
        <div class="row">
            <div class="col-lg-12 vcenter">
                <h1>Servers list</h1>
            </div>
        </div>
    </div>
                   <div class="row">
            <div class="col-lg-12 vcenter">
                <div id="noserver"><h3>You have no servers yet.</h3></div>
            </div>
            </div>
-->
        <div class="row">
            <div class="col-lg-12 vcenter">
<table border="0" ><!--class="pure-table">-->
<tr>
<td width="400px">
                   <div class="row">
            <div class="col-lg-12 vcenter">
<div id="clusterpiechart0" style="min-width: 210px; height: 400px; max-width: 600px; margin: 0 auto vcenter"></div> 
</div>
</div>
</td>
<td width="600px">
                   <div class="row">
            <div class="col-lg-12 vcenter">
<div id="clusterpiechart1" style="min-width: 210px; height: 400px; max-width: 600px; margin: 0 auto vcenter"></div>
</div>
</div>
</td>
<td width="400px">
                   <div class="row">
            <div class="col-lg-12 vcenter">
<div id="clusterpiechart2" style="min-width: 210px; height: 400px; max-width: 600px; margin: 0 auto vcenter"></div> 
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="row">
            <div class="col-lg-12 vcenter">
<table class="pure-table" >
    <thead>
        <tr>
            <th>Id</th>
            <th>Server Id</th>
            <th>IP</th>
            <th>Platform</th>
            <th>OS Type</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
    </thead>

    <tbody>
LIST_OF_SERVERS
    </tbody>
</table>
      </div>
      </div>
        <div id="msgBox" class="" style="display:none; width: 700px; margin-bottom: 15px;">
           <div id="message" class='error' style="margin-left: -20px; width: 126%; border: 2px solid; padding: 5px 0 5px 5px;"></div>
           <div style="clear:both"></div>
       </div>
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>
<style>
.largeWidth {
    margin: 0 auto;
    width: 85%;
}
</style>
<script>
//$(function () {
function openDetails(url){
    //alert('success');
    $.ajax({
        url: url,
        //data: data,
        //dataType: 'json',
        async: true,
        type: "GET",
        timeout: 128000,
        beforeSend: function(jqXHR, settings) {
                    jqXHR.setRequestHeader('Authorization', 'Basic ');
                    jqXHR.setRequestHeader('X-Ldap', 'rajamani');
                    jqXHR.setRequestHeader('Content-type', 'application/json');
                    },
        success: function(data, status, jqXHR) {
                var thead = '';
                for (var key in data){
                     if (data.hasOwnProperty(key) && (key.indexOf('_id') == -1)) {
                         thead += '<tr><th>'+key+'</th>';
                         thead += '<td>'+data[key]+'</td><td><input id="id_'+ key + '" name="' + key + '" type="text"  width="192px"></tr>';
                     }
                }
                bootbox.dialog({
                   title: "Server Details",
                   // message: '<table class="pure-table">' + 
                   //         thead + 
                   //         '</table>'
                message: '<div class="row">  ' +
                    '<div class="col-md-12">' +
        '<div id="formmsgBox" class="" style="display:none; width: 700px; margin-bottom: 15px;">' + 
           '<div id="formmessage" class="error" style="margin-left: -20px; width: 126%; border: 2px solid; padding: 5px 0 5px 5px;"></div>' + 
          ' <div style="clear:both"></div>' + 
       '</div>' + 
                    '<form id="myform" class="form-horizontal"> ' +
                    '<div class="form-group"> ' +
                    '<table class="pure-table">' + 
                            thead + 
                    '</table>' +
                    '</form> </div>  </div>',
/**/
               className: "largeWidth",
               buttons: {
                    success: {
                        label: "Save",
                        className: "btn-success",
                        callback: function () {
                            for (var key in data){
                            var newval = $('#id_'+key).val();
                            if (newval){
                               // mimimal input validation
                               var regexp = /^[a-zA-Z0-9.!@#$%^&*()-_]+/;
                               if (newval.search(regexp) == -1)
                               {
                                   $('#formmessage').html('Invalid value specified for ' + key +  '!! only alphanumeric and some special characters allowed!!');
                                   return false;
                               }      
                                    $.ajax({
                                            url: url.replace('details', 'attributeedit'),
                                            // data: $("#myform").serialize(),
                                            data: {"name":key, "value": newval},
                                            // dataType: 'json',
                                            // processData : false,
                                            async: true,
                                            type: "post",
                                            timeout: 128000,
                                            beforeSend: function(jqXHR, settings) {
                                                        // jqXHR.setRequestHeader('Authorization', 'Basic ');
                                                        // jqXHR.setRequestHeader('X-Ldap', 'rajamani');
                                                        // jqXHR.setRequestHeader('Content-type', 'application/json');
                                                        jqXHR.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
                                                        },
                                            success: function(data, status, jqXHR) {
                                                window.location.href='/devserverslist/';
                                            },
                                            error: function(data) {
                                                 $('#formmessage').html('Could not modify.');
                                            },
                                            done: function( data, textStatus, jqXHR ) {
                                            },
                                            complete : function (){
                                            },
                                          });
                                          //var answer = $("input[name='awesomeness']:checked").val()
                                          setTimeout(function() { return false; }, 10000);
                             }
                           }
                        }
                    }
                }
/**/
                }).find("div.modal-dialog").addClass("largeWidth");;
              },
        error: function(data) {
            $('#message').html('Could not retrieve details.');
            
        },
        done: function( data, textStatus, jqXHR ) {},
        complete : function (){}
        });
   setTimeout(function() { return false; }, 120000);
   return true;
}
</script>
<script>
$(function () {
var data = {}
var onSuccess = function(){}
var url = '/devserverslistjsonr/';
    $('#message').html("");
    $('#msgBox').hide();
var serverCount = [{name:'Active', y:0, color:Highcharts.getOptions().colors[0]}, {name:'Terminated', y:0, color:Highcharts.getOptions().colors[1]},];
var flavorCount = [{name:'Linux', y:0, color:Highcharts.getOptions().colors[0]}, {name:'Windows', y:0, color:Highcharts.getOptions().colors[1]},];
var platformCount = [{name:'Openstack', y:0, color:Highcharts.getOptions().colors[0]}, {name:'Other', y:0, color:Highcharts.getOptions().colors[1]},];
    //$('#message').html("You don't have any servers yet.");
    $.ajax({
        url: url,
        data: data,
        dataType: 'json',
        async: true,
        type: "GET",
        timeout: 128000,
        beforeSend: function(jqXHR, settings) {
                    jqXHR.setRequestHeader('Authorization', 'Basic ');
                    jqXHR.setRequestHeader('X-Ldap', 'rajamani');
                    jqXHR.setRequestHeader('Content-type', 'application/json');
                    },
        success: function(data, status, jqXHR) {
            $('#message').html("");
            //alert(data);
            if (data.length <= 0){
               //$('#message').html('Could not retrieve data');
              $('#message').html("You don't have any servers yet.");
           }else{
        hostname  = []
        data.forEach( function (dataItem, index){
             if (dataItem.fields.status.indexOf("Terminated") > -1){
                 serverCount[1]['y'] += 1;
             }else{
                 serverCount[0]['y'] += 1;
             }
             if (dataItem.fields.os_type.indexOf("linux") > -1){
                 flavorCount[0]['y'] += 1;
             }else{
                 flavorCount[1]['y'] += 1;
             }
             if (dataItem.fields.platform.indexOf("openstack") > -1){
                 platformCount[0]['y'] += 1;
             }else{
                 platformCount[1]['y'] += 1;
             }
        });
        if (serverCount.length > 0 ){
        pieChart('clusterpiechart0', 'Active:Terminated', 'Active:Terminated', serverCount);
        pieChart('clusterpiechart1', 'Linux:Windows', 'Linux:Windows', flavorCount);
        pieChart('clusterpiechart2', 'Openstack:Other', 'Openstack:Other', platformCount);
        }else{
        $('#clusterpiechart').html("You don't have any clusters yet.");
        $('#message').html("You don't have any clusters yet.");
        }
           }
        },
        error: function(data) {
            $('#message').html(data);
        },
       done: function( data, textStatus, jqXHR ) { },
       complete : function (){}
      });
   setTimeout(function() { 
return false; }, 120000);
});
</script>

            </div> <!-- col -->
        </div><!-- row -->
    </div><!-- container -->
<!--</div>--> <!-- content_body -->
</div> <!-- Main content -->
</body>

</html>
